æ˜é‡‘æ–‡ç« ä»‹ç»ï¼š[https://juejin.cn/post/7437006854122815497](https://juejin.cn/post/7437006854122815497)

---

## è¯´åœ¨å‰é¢

> ğŸ˜¶â€ğŸŒ«ï¸ å›½åº†è¿‡åï¼Œé‡‘ä»·å°±å¤§è·³æ°´ï¼Œä¸€ç›´å¾€ä¸‹è·Œï¼Œçœ‹æ ·å­æš‚æ—¶æ˜¯åœä¸ä¸‹æ¥äº†ï¼Œå¥³æœ‹å‹ä¹‹å‰ä¹Ÿå…¥æ‰‹äº†ä¸€ç‚¹é»„é‡‘ï¼Œå› æ­¤å¯¹é»„é‡‘ä»·æ ¼çš„å˜åŒ–æ¯”è¾ƒå…³å¿ƒï¼Œä¸ºäº†è®©å¥¹ä¸ç”¨æ•´å¤©ç›¯ç€å®æ—¶é‡‘ä»·ï¼Œæ‰€ä»¥å°±æäº†ä¸€ä¸ªé‡‘ä»·ç›‘æ§å·¥å…·ï¼Œè¶…å‡ºè®¾ç½®çš„é˜ˆå€¼å°±ä¼šå‘é€é‚®ä»¶æé†’ âœ‰ã€‚

![](https://files.mdnice.com/user/42027/e06f95b2-7e99-4921-a505-18edb85d2b18.jpg)

## ä¸€ã€é‡‘ä»·ä¿¡æ¯è·å–æ–¹æ¡ˆ

é‡‘ä»·å®æ—¶ä¿¡æ¯æœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è·å–åˆ°ï¼š

### 1ã€ç½‘é¡µä¿¡æ¯çˆ¬å–

æˆ‘ä»¬å¯ä»¥å…ˆæ‰¾åˆ°ä¸€äº›å®˜æ–¹çš„é‡‘ä»·ä¿¡æ¯ç½‘ç«™ï¼Œç„¶åç›´æ¥åˆ©ç”¨çˆ¬è™«ç›´æ¥çˆ¬å–ï¼Œæ¯”å¦‚ï¼š[https://quote.cngold.org/gjs/jjs.html](https://quote.cngold.org/gjs/jjs.html)

![](https://files.mdnice.com/user/42027/0b01df96-cf42-4c6b-a4c3-87fb17f7c406.png)

### 2ã€é€šè¿‡æ¥å£è·å–

ä¾‹å¦‚`nowapi`ä¸­å°±æœ‰é»„é‡‘æ•°æ®ä¿¡æ¯æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡æ¥å£æ¥è·å–ï¼š

![](https://files.mdnice.com/user/42027/a3179363-b9cc-493b-bf4b-638dfc753c8e.png)

## äºŒã€æé†’é˜ˆå€¼è®¾ç½®

### 1ã€åˆ›å»ºæ•°æ®åº“

![](https://files.mdnice.com/user/42027/ee815d28-163c-48ec-9ec8-f2ae932d6b2d.png)

### 2ã€ç›‘æ§é¡µé¢ç¼–å†™

ç®€å•ç¼–å†™ä¸€ä¸ªé¡µé¢ç”¨äºæ·»åŠ å’Œè°ƒæ•´æé†’å†…å®¹ã€‚

![](https://files.mdnice.com/user/42027/7840f9d4-9ff6-48de-a02b-c546ac317817.png)

## ä¸‰ã€ä¿®æ”¹é…ç½®ä¿¡æ¯

### 1ã€é‚®ç®±é…ç½®

è¿™é‡Œæˆ‘ä½¿ç”¨çš„ qq é‚®ç®±ä½œä¸ºå‘ä»¶è´¦å·ï¼Œéœ€è¦å¼€å¯é‚®ç®±æˆæƒï¼Œè·å–æˆæƒç ã€‚

```javascript
{
  host: "smtp.qq.com", // ä¸»æœº
  secureConnection: true, // ä½¿ç”¨ SSL
  port: 465, // SMTP ç«¯å£
  auth: {
    user: "jyeontu@qq.com", // è‡ªå·±ç”¨äºå‘é€é‚®ä»¶çš„è´¦å·
    pass: "jyeontu", // æˆæƒç (è¿™ä¸ªæ˜¯å‡çš„,æ”¹æˆè‡ªå·±è´¦å·å¯¹åº”å³å¯,è·å–æ–¹æ³•: QQé‚®ç®±-->è®¾ç½®-->è´¦æˆ·-->POP3/IMAP/SMTP/Exchange/CardDAV/CalDAVæœåŠ¡-->IMAP/SMTPå¼€å¯ å¤åˆ¶æˆæƒç )
  }
}
```

- **ï¼ˆ1ï¼‰æ‰“å¼€ pc ç«¯ qq é‚®ç®±ï¼Œç‚¹å‡»è®¾ç½®ï¼Œå†ç‚¹å‡»å¸æˆ·**

![](https://files.mdnice.com/user/42027/594fcb78-73d8-4ab2-a078-18297e60c2ad.png)

- **ï¼ˆ2ï¼‰å¾€ä¸‹æ‹‰ å¯å¼€å¯ POP3/SMTP æœåŠ¡ æ ¹æ®æç¤ºå³å¯è·å– qq é‚®ç®±æˆæƒç **

![](https://files.mdnice.com/user/42027/dce42e27-7577-4b0a-9347-d4c0d8fc3245.png)

- **ï¼ˆ3ï¼‰å°†è·å–åˆ°çš„æˆæƒç å¤åˆ¶åˆ°é…ç½®ä¿¡æ¯é‡Œå³å¯**

![](https://files.mdnice.com/user/42027/aedac3bf-6801-495b-979f-51d4ad32bc0f.png)

### 2ã€æ•°æ®åº“é…ç½®

å¡«å†™æ•°æ®åº“å¯¹åº”çš„é…ç½®ä¿¡æ¯ã€‚

```javascript
{
  host: "localhost",
  user: "root", //æ•°æ®åº“è´¦å·
  password: "jyeontu", //æ•°æ®åº“å¯†ç 
  database: "test", //æ•°æ®åº“åç§°
}
```

### 3ã€nowapi é…ç½®

å…è´¹å¼€é€šåå°†`AppKey`å’Œ`Sign`æ›¿æ¢æˆè‡ªå·±çš„å°±å¯ä»¥äº†ã€‚

![](https://files.mdnice.com/user/42027/45aa26bb-61c6-46d3-bd6b-0c623e6156aa.png)

```javascript
{
  AppKey: AppKey,
  Sign: "Sign",
}
```

## å››ã€è„šæœ¬åŠŸèƒ½ç¼–å†™

### 1ã€è·å–é‡‘ä»·ä¿¡æ¯

æˆ‘ç›´æ¥ä½¿ç”¨`nowapi`çš„å…è´¹è¯•ç”¨å¥—é¤ï¼Œé…é¢æ˜¯`10 æ¬¡/å°æ—¶`ã€‚

![](https://files.mdnice.com/user/42027/b46e41a3-6047-4c86-8e77-34958f9ebe97.png)

```javascript
const { nowapiConfig } = require("./config.js");
async function getGoldPrice() {
  const result = await axios.get(
    `https://sapi.k780.com/?app=finance.gold_price&goldid=1053&appkey=${nowapiConfig.AppKey}&sign=${nowapiConfig.Sign}&format=json`
  );
  return result.data.result.dtList["1053"];
}
```

è·å–åˆ°çš„æ•°æ®å¦‚ä¸‹ï¼š

![](https://files.mdnice.com/user/42027/953df25c-5a0c-4f8c-a5d6-9a6095217f7a.png)

### 2ã€è·å–æ¶ˆæ¯æé†’é˜ˆå€¼

#### ï¼ˆ1ï¼‰è¿æ¥æ•°æ®åº“

ä½¿ç”¨å¡«å†™å¥½çš„æ•°æ®åº“é…ç½®ä¿¡æ¯è¿æ¥æ•°æ®åº“

```javascript
const mysql = require("mysql");
const { dbConfig } = require("./config.js");

const connection = mysql.createConnection(dbConfig);

function connectDatabase() {
  return new Promise((resolve) => {
    connection.connect((error) => {
      if (error) throw error;
      console.log("æˆåŠŸè¿æ¥æ•°æ®åº“ï¼");
      resolve("æˆåŠŸè¿æ¥æ•°æ®åº“ï¼");
    });
  });
}
```

#### ï¼ˆ2ï¼‰æŸ¥è¯¢æ•°æ®

```javascript
function mysqlQuery(sqlStr) {
  return new Promise((resolve) => {
    connection.query(sqlStr, (error, results) => {
      if (error) throw error;
      resolve(results);
    });
  });
}

async function getMessage() {
  const sqlStr =
    "select * from t_message where isShow = 1 and isActive = 1 and type = 'é‡‘ä»·ç›‘æ§';";
  const res = await mysqlQuery(sqlStr);
  return { ...res[0] };
}
```

è·å–åˆ°çš„æ•°æ®å¦‚ä¸‹ï¼š

![](https://files.mdnice.com/user/42027/ecec4037-a8bd-4ed7-a77f-2092897660a5.png)

### 3ã€å‘é€æé†’é‚®ä»¶

#### ï¼ˆ1ï¼‰åˆ›å»ºé‚®ä»¶ä¼ è¾“å¯¹è±¡

ä½¿ç”¨å¡«å†™å¥½çš„é‚®ç®±é…ç½®ä¿¡æ¯ï¼Œåˆ›å»ºé‚®ä»¶ä¼ è¾“å¯¹è±¡

```javascript
const nodemailer = require("nodemailer");
const { mail } = require("./config.js");

const smtpTransport = nodemailer.createTransport(mail);
const sendMail = (options) => {
  return new Promise((resolve) => {
    const mailOptions = {
      from: mail.auth.user,
      ...options,
    };
    // å‘é€é‚®ä»¶
    smtpTransport.sendMail(mailOptions, function (error, response) {
      if (error) {
        console.error("å‘é€é‚®ä»¶å¤±è´¥ï¼š", error);
      } else {
        console.log("é‚®ä»¶å‘é€æˆåŠŸ");
      }
      smtpTransport.close(); // å‘é€å®Œæˆå…³é—­è¿æ¥æ± 
      resolve(true);
    });
  });
};
module.exports = sendMail;
```

#### ï¼ˆ2ï¼‰é˜ˆå€¼åˆ¤æ–­

åˆ¤æ–­è·å–åˆ°çš„é‡‘ä»·ä¿¡æ¯æ˜¯å¦è¶…å‡ºé˜ˆå€¼èŒƒå›´æ¥å†³å®šæ˜¯å¦å‘é€é‚®ä»¶æé†’

```javascript
async function mail(messageInfo, goldInfo) {
  let { minVal = -Infinity, maxVal = Infinity } = messageInfo;
  let { buy_price } = goldInfo;
  minVal = parseFloat(minVal);
  maxVal = parseFloat(maxVal);
  buy_price = parseFloat(buy_price);
  if (minVal < buy_price && maxVal > buy_price) {
    return;
  }
  const mailOptions = {
    to: messageInfo.mail.replaceAll("ã€", ","), // æ¥æ”¶äººåˆ—è¡¨,å¤šäººç”¨','éš”å¼€
    subject: "é‡‘ä»·ç›‘æ§",
    text: `å½“å‰é‡‘ä»·ä¸º${buy_price.toFixed(2)}`,
  };
  await sendMail(mailOptions);
}
```

## äº”ã€å®šæ—¶æ‰§è¡Œè„šæœ¬

å¯ä»¥ä½¿ç”¨`corn`ç¼–å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å®šæ—¶æ‰§è¡Œè„šæœ¬å³å¯ã€‚

- `* * * * * *`åˆ†åˆ«å¯¹åº”ï¼šç§’ã€åˆ†é’Ÿã€å°æ—¶ã€æ—¥ã€æœˆã€æ˜ŸæœŸã€‚
- æ¯ä¸ªå­—æ®µå¯ä»¥æ˜¯å…·ä½“çš„å€¼ã€èŒƒå›´ã€é€šé…ç¬¦ï¼ˆ\*è¡¨ç¤ºæ¯ä¸€ä¸ªï¼‰æˆ–ä¸€äº›ç‰¹æ®Šçš„è¡¨è¾¾å¼ã€‚

ä¾‹å¦‚ï¼š

```shell
0 0 * * *ï¼šæ¯å¤©åˆå¤œ 0 ç‚¹æ‰§è¡Œã€‚
0 30 9 * * 1-5ï¼šå‘¨ä¸€åˆ°å‘¨äº”ä¸Šåˆ 9:30 æ‰§è¡Œã€‚
```

ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®åˆé€‚çš„ cron è¡¨è¾¾å¼æ¥å®šæ—¶æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ã€‚

## å…­ã€æ•ˆæœå±•ç¤º

å¦‚æœé‡‘ä»·ä¸åœ¨æˆ‘ä»¬è®¾ç½®çš„é˜ˆå€¼å†…æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šæ”¶åˆ°é‚®ä»¶å‘ŠçŸ¥å½“å‰é‡‘ä»·ï¼š

![](https://files.mdnice.com/user/42027/5cf97f3c-9cf4-4c16-a206-8cc69cfde75e.png)

![](https://files.mdnice.com/user/42027/4e8c6eec-9180-4f5c-a404-db0cc7571b71.png)

![](https://files.mdnice.com/user/42027/e722c849-df65-422d-8ba1-88d06f98585a.jpg)

## ä¸ƒã€è„šæœ¬ä½¿ç”¨

### 1ã€æºç ä¸‹è½½

```shell
git clone https://gitee.com/zheng_yongtao/node-scripting-tool.git
```

- æºç å·²ç»ä¸Šä¼ åˆ° gitee ä»“åº“

[https://gitee.com/zheng_yongtao/node-scripting-tool](https://gitee.com/zheng_yongtao/node-scripting-tool)

- å…·ä½“ç›®å½•å¦‚ä¸‹ï¼š

![](https://files.mdnice.com/user/42027/0ce0c441-0f26-4d0d-9b05-814e7ee31e2b.png)

### 2ã€ä¾èµ–ä¸‹è½½

```shell
npm install
```

### 3ã€é…ç½®æ•°æ®å¡«å†™

![](https://files.mdnice.com/user/42027/e2edb80f-5330-4913-a7b5-158506693bd3.png)

è¿™é‡Œçš„é…ç½®ä¿¡æ¯éœ€è¦ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„ä¿¡æ¯ï¼Œæ•°æ®åº“ã€gitee ä»“åº“ã€nowapi é…ç½®ã€‚

### 4ã€è„šæœ¬è¿è¡Œ

```shell
node index.js
```

## æ›´å¤šè„šæœ¬

è¯¥è„šæœ¬ä»“åº“é‡Œè¿˜æœ‰å¾ˆå¤šæœ‰è¶£çš„è„šæœ¬å·¥å…·ï¼Œæœ‰å…´è¶£çš„ä¹Ÿå¯ä»¥çœ‹çœ‹å…¶ä»–çš„ï¼š[https://gitee.com/zheng_yongtao/node-scripting-tool](https://gitee.com/zheng_yongtao/node-scripting-tool)

---

**ğŸŒŸ è§‰å¾—æœ‰å¸®åŠ©çš„å¯ä»¥ç‚¹ä¸ª star\~**

**ğŸ–Š æœ‰ä»€ä¹ˆé—®é¢˜æˆ–é”™è¯¯å¯ä»¥æŒ‡å‡ºï¼Œæ¬¢è¿ pr\~**

**ğŸ“¬ æœ‰ä»€ä¹ˆæƒ³è¦å®ç°çš„å·¥å…·æˆ–æƒ³æ³•å¯ä»¥è”ç³»æˆ‘\~**

---

## å…¬ä¼—å·

å…³æ³¨å…¬ä¼—å·ã€å‰ç«¯ä¹Ÿèƒ½è¿™ä¹ˆæœ‰è¶£ã€ï¼Œè·å–æ›´å¤šæœ‰è¶£å†…å®¹ã€‚

## è¯´åœ¨åé¢

> ğŸ‰ è¿™é‡Œæ˜¯ JYeontuï¼Œç°åœ¨æ˜¯ä¸€åå‰ç«¯å·¥ç¨‹å¸ˆï¼Œæœ‰ç©ºä¼šåˆ·åˆ·ç®—æ³•é¢˜ï¼Œå¹³æ—¶å–œæ¬¢æ‰“ç¾½æ¯›çƒ ğŸ¸ ï¼Œå¹³æ—¶ä¹Ÿå–œæ¬¢å†™äº›ä¸œè¥¿ï¼Œæ—¢ä¸ºè‡ªå·±è®°å½• ğŸ“‹ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥å¯¹å¤§å®¶æœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢çš„å¸®åŠ©ï¼Œå†™çš„ä¸å¥½æœ›å¤šå¤šè°…è§£ ğŸ™‡ï¼Œå†™é”™çš„åœ°æ–¹æœ›æŒ‡å‡ºï¼Œå®šä¼šè®¤çœŸæ”¹è¿› ğŸ˜Šï¼Œå¶å°”ä¹Ÿä¼šåœ¨è‡ªå·±çš„å…¬ä¼—å·ã€`å‰ç«¯ä¹Ÿèƒ½è¿™ä¹ˆæœ‰è¶£`ã€å‘ä¸€äº›æ¯”è¾ƒæœ‰è¶£çš„æ–‡ç« ï¼Œæœ‰å…´è¶£çš„ä¹Ÿå¯ä»¥å…³æ³¨ä¸‹ã€‚åœ¨æ­¤è°¢è°¢å¤§å®¶çš„æ”¯æŒï¼Œæˆ‘ä»¬ä¸‹æ–‡å†è§ ğŸ™Œã€‚
